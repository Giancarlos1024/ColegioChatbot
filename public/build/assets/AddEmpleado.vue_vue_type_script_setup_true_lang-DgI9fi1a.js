import{d as W,aa as G,r as m,c as r,a as d,F as q,b as i,f as n,w,g as a,j as u,i as x,t as g,a2 as F}from"./app-CSI2DTQR.js";import{s as z}from"./index-Bd5u6C13.js";import{s as J}from"./index-C_q0UAfk.js";import{s as y}from"./index-CIJ9kEDP.js";import{s as V}from"./index-DWx6GgBR.js";import{s as K}from"./index-BsSS1dRr.js";import{s as Q}from"./index-DTrYfW8t.js";import{s as X}from"./index-6IO2ceo-.js";import Y from"./toolsEmployee-tZhXQudI.js";const Z={class:"flex flex-col gap-6"},ee={class:"grid grid-cols-12 gap-4"},le={class:"col-span-12 sm:col-span-6"},ae={key:0,class:"text-red-500"},te={key:1,class:"text-red-500"},oe={class:"col-span-12 sm:col-span-6"},se={key:0,class:"text-red-500"},ie={key:1,class:"text-red-500"},re={class:"col-span-12 sm:col-span-6"},de={key:0,class:"text-red-500"},ne={key:1,class:"text-red-500"},ue={class:"col-span-12 sm:col-span-6"},ce={key:0,class:"text-red-500"},me={key:1,class:"text-red-500"},pe={class:"col-span-12"},ve={key:0,class:"text-red-500"},fe={key:1,class:"text-red-500"},ge={class:"col-span-12 flex items-center gap-3"},ye={key:0,class:"text-red-500"},be={class:"col-span-12"},_e={class:"mt-2 flex flex-wrap gap-2"},xe={key:0,class:"mt-2 flex flex-col gap-2"},he={class:"flex gap-2 flex-wrap mt-2"},ke={key:1,class:"mt-2 flex flex-col gap-2 items-center"},we=["src"],Ve={key:2,class:"text-red-500"},Ce={key:3,class:"text-red-500"},Re=W({__name:"AddEmpleado",emits:["empleado-agregado"],setup(Ee,{emit:L}){const p=G(),h=m(!1),c=m(!1),o=m({}),D=m([]),l=m({name:"",apellido:"",codigo:"",employee_type_id:null,idHuella:"",foto:null,state:!0}),b=m(null),C=m(!1),v=m(null);let k=null;const R=L;function N(){l.value={name:"",apellido:"",codigo:"",employee_type_id:null,idHuella:"",foto:null,state:!0},b.value=null,o.value={},c.value=!1}function j(){N(),h.value=!0,B()}function I(){h.value=!1,N()}function B(){F.get("/tipo_empleado",{params:{state:1}}).then(s=>D.value=s.data.data).catch(()=>{p.add({severity:"error",summary:"Error",detail:"No se pudo cargar los tipos de empleado",life:3e3})})}function P(s){var f;const t=((f=s.target.files)==null?void 0:f[0])??null;t&&(l.value.foto=t,b.value=URL.createObjectURL(t))}function U(){navigator.mediaDevices.getUserMedia({video:!0}).then(s=>{k=s,C.value=!0,v.value&&(v.value.srcObject=k)}).catch(()=>{p.add({severity:"error",summary:"Error",detail:"No se pudo acceder a la cámara",life:3e3})})}function H(){k&&k.getTracks().forEach(s=>s.stop()),C.value=!1}function A(){if(!v.value)return;const s=document.createElement("canvas");s.width=v.value.videoWidth,s.height=v.value.videoHeight;const e=s.getContext("2d");e&&(e.drawImage(v.value,0,0,s.width,s.height),s.toBlob(t=>{if(!t)return;const f=new File([t],`empleado_${Date.now()}.png`,{type:"image/png"});l.value.foto=f,b.value=URL.createObjectURL(f),H()},"image/png"))}function O(){b.value=null,l.value.foto=null,U()}function M(){c.value=!0,o.value={};const{name:s,apellido:e,codigo:t,employee_type_id:f,idHuella:E,foto:S}=l.value;if(!s||!e||!t||!f||!E||!S){p.add({severity:"warn",summary:"Campos incompletos",detail:"Debe completar todos los campos",life:3e3});return}if(!/^\d{8}$/.test(t)){p.add({severity:"warn",summary:"DNI inválido",detail:"El DNI debe ser 8 números",life:3e3});return}if(!Number.isInteger(E)||E<=0){p.add({severity:"warn",summary:"Huella inválida",detail:"La huella debe ser un número",life:3e3});return}const T=new FormData;for(const _ in l.value){const $=l.value[_];$!==null&&T.append(_,$)}F.post("/empleado",T,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{p.add({severity:"success",summary:"Éxito",detail:"Empleado registrado",life:3e3}),I(),R("empleado-agregado")}).catch(_=>{_.response&&_.response.status===422?o.value=_.response.data.errors||{}:p.add({severity:"error",summary:"Error",detail:"No se pudo registrar el empleado",life:3e3})})}return(s,e)=>(d(),r(q,null,[i(n(J),{class:"mb-6"},{start:w(()=>[i(n(y),{label:"Nuevo empleado",icon:"pi pi-plus",severity:"secondary",class:"mr-2",onClick:j})]),end:w(()=>[i(Y)]),_:1}),i(n(z),{visible:h.value,"onUpdate:visible":e[6]||(e[6]=t=>h.value=t),style:{width:"90%",maxWidth:"600px"},header:"Registro de empleado",modal:!0},{footer:w(()=>[i(n(y),{label:"Cancelar",icon:"pi pi-times",text:"",onClick:I}),i(n(y),{label:"Guardar",icon:"pi pi-check",onClick:M})]),default:w(()=>[a("div",Z,[a("div",ee,[a("div",le,[e[7]||(e[7]=a("label",{class:"block font-bold mb-2"},[x("Nombre "),a("span",{class:"text-red-500"},"*")],-1)),i(n(V),{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.name=t),placeholder:"Ingrese su nombre",maxlength:"150",class:"w-full"},null,8,["modelValue"]),c.value&&!l.value.name?(d(),r("small",ae,"El nombre es obligatorio.")):u("",!0),o.value.name?(d(),r("small",te,g(o.value.name[0]),1)):u("",!0)]),a("div",oe,[e[8]||(e[8]=a("label",{class:"block font-bold mb-2"},[x("Apellido "),a("span",{class:"text-red-500"},"*")],-1)),i(n(V),{modelValue:l.value.apellido,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.apellido=t),placeholder:"Ingrese su apellido",maxlength:"150",class:"w-full"},null,8,["modelValue"]),c.value&&!l.value.apellido?(d(),r("small",se,"El apellido es obligatorio.")):u("",!0),o.value.apellido?(d(),r("small",ie,g(o.value.apellido[0]),1)):u("",!0)]),a("div",re,[e[9]||(e[9]=a("label",{class:"block font-bold mb-2"},[x("DNI "),a("span",{class:"text-red-500"},"*")],-1)),i(n(V),{modelValue:l.value.codigo,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.codigo=t),placeholder:"Ingrese su DNI",maxlength:"8",class:"w-full"},null,8,["modelValue"]),c.value&&!l.value.codigo?(d(),r("small",de,"El DNI es obligatorio.")):u("",!0),o.value.codigo?(d(),r("small",ne,g(o.value.codigo[0]),1)):u("",!0)]),a("div",ue,[e[10]||(e[10]=a("label",{class:"block font-bold mb-2"},[x("ID Huella "),a("span",{class:"text-red-500"},"*")],-1)),i(n(V),{modelValue:l.value.idHuella,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.idHuella=t),modelModifiers:{number:!0},placeholder:"Ingrese ID de huella",class:"w-full"},null,8,["modelValue"]),c.value&&!l.value.idHuella?(d(),r("small",ce,"El ID de huella es obligatorio.")):u("",!0),o.value.idHuella?(d(),r("small",me,g(o.value.idHuella[0]),1)):u("",!0)]),a("div",pe,[e[11]||(e[11]=a("label",{class:"block font-bold mb-2"},[x("Tipo de Empleado "),a("span",{class:"text-red-500"},"*")],-1)),i(n(X),{modelValue:l.value.employee_type_id,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.employee_type_id=t),options:D.value,optionLabel:"name",optionValue:"id",placeholder:"Seleccione tipo de empleado",class:"w-full",filter:"",filterPlaceholder:"Buscar tipo de empleado"},null,8,["modelValue","options"]),c.value&&!l.value.employee_type_id?(d(),r("small",ve,"Debe seleccionar un tipo.")):u("",!0),o.value.employee_type_id?(d(),r("small",fe,g(o.value.employee_type_id[0]),1)):u("",!0)]),a("div",ge,[i(n(K),{modelValue:l.value.state,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.state=t),binary:!0},null,8,["modelValue"]),i(n(Q),{value:l.value.state?"Activo":"Inactivo",severity:l.value.state?"success":"danger"},null,8,["value","severity"]),o.value.state?(d(),r("small",ye,g(o.value.state[0]),1)):u("",!0)]),a("div",be,[e[12]||(e[12]=a("label",{class:"block font-bold mb-2"},[x("Foto "),a("span",{class:"text-red-500"},"*")],-1)),a("input",{type:"file",onChange:P,accept:"image/png, image/jpeg",class:"w-full"},null,32),a("div",_e,[i(n(y),{label:"Tomar Foto",icon:"pi pi-camera",class:"p-button-secondary",onClick:U})]),C.value?(d(),r("div",xe,[a("video",{ref_key:"video",ref:v,autoplay:"",playsinline:"",class:"w-full max-w-xs mx-auto"},null,512),a("div",he,[i(n(y),{label:"Capturar",icon:"pi pi-check",class:"p-button-success",onClick:A}),i(n(y),{label:"Cancelar",icon:"pi pi-times",class:"p-button-danger",onClick:H})])])):u("",!0),b.value?(d(),r("div",ke,[a("img",{src:b.value,alt:"Preview",class:"w-full max-w-xs h-auto border rounded"},null,8,we),i(n(y),{label:"Reintentar",icon:"pi pi-refresh",class:"p-button-warning",onClick:O})])):u("",!0),c.value&&!l.value.foto?(d(),r("small",Ve,"La foto es obligatoria.")):u("",!0),o.value.foto?(d(),r("small",Ce,g(o.value.foto[0]),1)):u("",!0)])])])]),_:1},8,["visible"])],64))}});export{Re as _};
