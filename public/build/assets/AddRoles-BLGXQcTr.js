import{d as q,aa as z,r as m,p as F,o as G,af as M,c as t,a as r,F as k,b as i,f as n,w as p,g as a,j as L,i as E,t as C,X as V,_ as N,a0 as $,a2 as P}from"./app-CSI2DTQR.js";import{s as O}from"./index-Bd5u6C13.js";import{s as W}from"./index-C_q0UAfk.js";import{s as g}from"./index-CIJ9kEDP.js";import{s as X}from"./index-DWx6GgBR.js";import{s as H}from"./index-BsSS1dRr.js";import{s as J}from"./index-CZrl9iAD.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D_KOsQEr.js";import"./index-OH50f74-.js";const Q={class:"flex flex-col gap-6"},Y={key:0,class:"text-red-500"},Z={key:1,class:"text-red-500"},ee={key:2,class:"text-red-500"},se={key:0,class:"text-center p-4"},oe={key:1,class:"permisos-container"},ae={class:"flex justify-between items-center w-full"},le={class:"font-bold"},te={class:"fieldset-actions flex gap-2"},re={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},ie=["for"],ne=q({__name:"AddRoles",emits:["rol-agregado"],setup(de,{emit:R}){const y=z(),v=m(!1),b=m(!1),f=m({}),d=m({name:""}),w=m([]),u=m([]),x=m(!1),S=R;async function T(){x.value=!0;try{const o=await P.get("/rol/Permisos");w.value=o.data.permissions}catch(o){console.error("Error al obtener permisos:",o),y.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los permisos",life:3e3})}finally{x.value=!1}}const h=F(()=>{const o={};return w.value.forEach(e=>{const l=e.name.split(" "),s=l.length>1?l[1]:"General";o[s]||(o[s]=[]),o[s].push(e)}),o});function A(o){const e=[...u.value];h.value[o].map(s=>s.id).forEach(s=>{e.includes(s)||e.push(s)}),u.value=e}function B(o){const e=h.value[o].map(l=>l.id);u.value=u.value.filter(l=>!e.includes(l))}function I(){d.value={name:""},u.value=[],v.value=!1,f.value={},b.value=!0}function D(){b.value=!1,v.value=!1,f.value={}}function U(){v.value=!0,d.value.name&&d.value.name.length>=2&&P.post("/rol",{name:d.value.name,permissions:u.value}).then(()=>{y.add({severity:"success",summary:"Ã‰xito",detail:"Rol guardado correctamente",life:3e3}),D(),S("rol-agregado")}).catch(o=>{var l,s;const e=o;(s=(l=e.response)==null?void 0:l.data)!=null&&s.errors?f.value=e.response.data.errors:y.add({severity:"error",summary:"Error",detail:"Error al guardar el rol",life:3e3})})}return G(()=>{T()}),(o,e)=>{const l=M("tooltip");return r(),t(k,null,[i(n(W),{class:"mb-6"},{start:p(()=>[i(n(g),{label:"Nuevo rol",icon:"pi pi-plus",severity:"secondary",class:"mr-2",onClick:I})]),end:p(()=>[...e[3]||(e[3]=[])]),_:1}),i(n(O),{visible:b.value,"onUpdate:visible":e[2]||(e[2]=s=>b.value=s),style:{width:"95vw",maxWidth:"1000px"},header:"Registro de Roles y Permisos",modal:!0},{footer:p(()=>[i(n(g),{label:"Cancelar",icon:"pi pi-times",text:"",onClick:D}),i(n(g),{label:"Guardar",icon:"pi pi-check",onClick:U})]),default:p(()=>[a("div",Q,[a("div",null,[e[4]||(e[4]=a("label",{for:"name",class:"block font-bold mb-3"},[E("Nombre "),a("span",{class:"text-red-500"},"*")],-1)),i(n(X),{id:"name",modelValue:d.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value.name=s),required:"",maxlength:"100",class:"w-full"},null,8,["modelValue"]),v.value&&!d.value.name?(r(),t("small",Y,"El nombre es obligatorio.")):v.value&&d.value.name&&d.value.name.length<2?(r(),t("small",Z," El nombre debe tener al menos 2 caracteres. ")):f.value.name?(r(),t("small",ee,C(f.value.name[0]),1)):L("",!0)]),a("div",null,[e[6]||(e[6]=a("label",{class:"block font-bold mb-3"},[E("Permisos "),a("span",{class:"text-red-500"},"*")],-1)),x.value?(r(),t("div",se,[...e[5]||(e[5]=[a("i",{class:"pi pi-spin pi-spinner text-2xl"},null,-1),a("p",null,"Cargando permisos...",-1)])])):(r(),t("div",oe,[(r(!0),t(k,null,V(h.value,(s,_)=>(r(),t("div",{key:_,class:"mb-4"},[i(n(J),{toggleable:!0,class:"shadow-sm"},{legend:p(()=>[a("div",ae,[a("span",le,C(_),1),a("div",te,[N(i(n(g),{icon:"pi pi-check-square",size:"small",text:"",onClick:$(c=>A(_),["stop"])},null,8,["onClick"]),[[l,{value:"Seleccionar todos",showDelay:1e3,hideDelay:300}]]),N(i(n(g),{icon:"pi pi-times",severity:"danger",size:"small",text:"",onClick:$(c=>B(_),["stop"]),tooltipOptions:"{ position: 'top' }"},null,8,["onClick"]),[[l,{value:"Deseleccionar todos",showDelay:1e3,hideDelay:300}]])])])]),default:p(()=>[a("div",re,[(r(!0),t(k,null,V(s,c=>(r(),t("div",{key:c.id,class:"flex items-center gap-2 p-2 rounded-md"},[i(n(H),{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=j=>u.value=j),inputId:"permiso_"+c.id,value:c.id},null,8,["modelValue","inputId","value"]),a("label",{for:"permiso_"+c.id,class:"cursor-pointer"},C(c.name),9,ie)]))),128))])]),_:2},1024)]))),128))]))])])]),_:1},8,["visible"])],64)}}}),xe=K(ne,[["__scopeId","data-v-907c9600"]]);export{xe as default};
