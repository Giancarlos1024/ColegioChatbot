import{d as G,r as i,aa as O,B as U,a2 as f,o as W,e as h,a as N,w as A,g as s,b as r,i as n,f as t,U as H,c as C,j as J,t as Q}from"./app-CSI2DTQR.js";import{s as X}from"./index-Bd5u6C13.js";import{s as v}from"./index-DWx6GgBR.js";import{s as D}from"./index-CIJ9kEDP.js";import{s as Y}from"./index-DTrYfW8t.js";import{s as Z}from"./index-BsSS1dRr.js";import{s as ee}from"./index-saBHE4wW.js";import{s as ae}from"./index-6IO2ceo-.js";const le={class:"flex flex-col gap-6"},se={class:"grid grid-cols-1 sm:grid-cols-12 gap-4"},oe={class:"sm:col-span-9"},te={class:"sm:col-span-3 flex flex-col"},re={class:"flex items-center gap-3"},ie={class:"grid grid-cols-1 sm:grid-cols-12 gap-4"},de={class:"sm:col-span-6"},ne={class:"sm:col-span-6"},ue={class:"grid grid-cols-1 sm:grid-cols-12 gap-4"},me={class:"sm:col-span-6"},ce={class:"sm:col-span-6"},pe={key:0,class:"text-red-500"},ve={key:1,class:"text-red-500"},be={class:"flex flex-col sm:flex-row gap-2 justify-end"},we=G({__name:"updateUsuario",props:{visible:{type:Boolean},UsuarioId:{}},emits:["update:visible","updated"],setup(B,{emit:z}){const u=B,k=z,g=i({}),w=i(!1),d=O(),a=i({dni:"",name:"",apellidos:"",nacimiento:"",email:"",username:"",status:!0,role_id:null}),b=i(""),y=i(!1),q=i(""),S=i(""),$=i([]),m=i(u.visible);U(()=>u.visible,o=>{m.value=o}),U(m,o=>{k("update:visible",o)}),U(()=>u.visible,o=>{o&&u.UsuarioId&&j()});const j=async()=>{if(u.UsuarioId){y.value=!0;try{const e=(await f.get(`/usuarios/${u.UsuarioId}`)).data.user;a.value={dni:e.dni||"",name:e.name||"",apellidos:e.apellidos||"",nacimiento:e.nacimiento||"",email:e.email||"",username:e.username||"",status:e.status===!0||e.status===1||e.status==="activo",role_id:e.role_id?Number(e.role_id):null},q.value=e.email||"",S.value=e.username||"",b.value=""}catch(o){d.add({severity:"error",summary:"Error",detail:"No se pudo cargar el usuario",life:3e3}),console.error(o)}finally{y.value=!1}}},M=async()=>{var o,e;w.value=!0,g.value={};try{const l={dni:a.value.dni,name:a.value.name,apellidos:a.value.apellidos,nacimiento:a.value.nacimiento,email:a.value.email,username:a.value.username,status:a.value.status,role_id:a.value.role_id};b.value.trim()!==""&&(l.password=b.value),await f.put(`/usuarios/${u.UsuarioId}`,l),d.add({severity:"success",summary:"Actualizado",detail:"Usuario actualizado correctamente",life:3e3}),m.value=!1,k("updated")}catch(l){f.isAxiosError(l)&&((e=(o=l.response)==null?void 0:o.data)!=null&&e.errors)?(g.value=l.response.data.errors,d.add({severity:"error",summary:"Error de validación",detail:"Revisa los campos e intenta nuevamente.",life:5e3})):d.add({severity:"error",summary:"Error",detail:"No se pudo actualizar el usuario",life:3e3}),console.error(l)}},P=async()=>{if(a.value.dni.length!==8){d.add({severity:"warn",summary:"Advertencia",detail:"El DNI debe tener 8 dígitos.",life:3e3});return}try{const e=(await f.get(`/consulta/${a.value.dni}`)).data;if(e.success&&e.data&&e.data.nombre_completo){const l=e.data.nombres??"",c=e.data.apellido_paterno??"",p=e.data.apellido_materno??"",V=e.data.fecha_nacimiento??"";a.value.name=l,a.value.apellidos=`${c} ${p}`.trim(),a.value.nacimiento=V,a.value.username=F(l,c,p,V)}else d.add({severity:"warn",summary:"Advertencia",detail:"No se encontraron datos para este DNI.",life:3e3})}catch(o){console.error(o),d.add({severity:"error",summary:"Error",detail:"No se pudo consultar el DNI.",life:3e3})}},F=(o,e,l,c)=>{var E,_,I;const p=x=>(x==null?void 0:x.replace(/ñ/g,"n").replace(/Ñ/g,"n").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase())||"",K=((E=p(o).trim().split(/\s+/)[0])==null?void 0:E.charAt(0))||"",L=p(e).replace(/\s+/g,""),R=p(l).replace(/\s+/g,"").slice(0,2)||"",T=((I=(_=c==null?void 0:c.split("/"))==null?void 0:_[0])==null?void 0:I.padStart(2,"0"))||"00";return`${K}${L}${R}${T}`.toUpperCase()};return W(()=>{f.get("/rol").then(o=>{$.value=o.data.data,a.value&&a.value.role_id&&(a.value.role_id=Number(a.value.role_id))}).catch(()=>{d.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los roles",life:3e3})})}),(o,e)=>(N(),h(t(X),{visible:m.value,"onUpdate:visible":e[10]||(e[10]=l=>m.value=l),header:"Editar Usuario",modal:"",closable:!0,closeOnEscape:!0,style:{width:"95vw",maxWidth:"600px"}},{footer:A(()=>[s("div",be,[r(t(D),{label:"Cancelar",icon:"pi pi-times",text:"",onClick:e[9]||(e[9]=l=>m.value=!1)}),r(t(D),{label:"Guardar",icon:"pi pi-check",onClick:M,loading:y.value},null,8,["loading"])])]),default:A(()=>[s("div",le,[s("div",se,[s("div",oe,[e[11]||(e[11]=s("label",{class:"block font-bold mb-3"},[n("DNI "),s("span",{class:"text-red-500"},"*")],-1)),r(t(v),{modelValue:a.value.dni,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.dni=l),maxlength:"8",required:"",onKeyup:H(P,["enter"]),fluid:""},null,8,["modelValue"])]),s("div",te,[e[12]||(e[12]=s("label",{class:"block font-bold mb-2"},[n("Estado "),s("span",{class:"text-red-500"},"*")],-1)),s("div",re,[r(t(Z),{modelValue:a.value.status,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.status=l),binary:!0,inputId:"status"},null,8,["modelValue"]),r(t(Y),{value:a.value.status?"Con Acceso":"Sin Acceso",severity:a.value.status?"success":"danger"},null,8,["value","severity"])])])]),s("div",null,[e[13]||(e[13]=s("label",{class:"block font-bold mb-3"},[n("Nombre completo "),s("span",{class:"text-red-500"},"*")],-1)),r(t(v),{modelValue:a.value.name,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.name=l),required:"",disabled:"",maxlength:"100",fluid:""},null,8,["modelValue"])]),s("div",null,[e[14]||(e[14]=s("label",{class:"block font-bold mb-3"},[n("Apellidos "),s("span",{class:"text-red-500"},"*")],-1)),r(t(v),{modelValue:a.value.apellidos,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.apellidos=l),required:"",disabled:"",maxlength:"100",fluid:""},null,8,["modelValue"])]),s("div",ie,[s("div",de,[e[15]||(e[15]=s("label",{class:"block font-bold mb-3"},[n("Fecha de nacimiento "),s("span",{class:"text-red-500"},"*")],-1)),r(t(v),{modelValue:a.value.nacimiento,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.nacimiento=l),required:"",maxlength:"100",fluid:"",disabled:""},null,8,["modelValue"])]),s("div",ne,[e[16]||(e[16]=s("label",{class:"block font-bold mb-3"},[n("Usuario "),s("span",{class:"text-red-500"},"*")],-1)),r(t(v),{modelValue:a.value.username,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.username=l),fluid:"",disabled:""},null,8,["modelValue"])])]),s("div",null,[e[17]||(e[17]=s("label",{class:"block font-bold mb-3"},[n("Email "),s("span",{class:"text-red-500"},"*")],-1)),r(t(v),{modelValue:a.value.email,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.email=l),maxlength:"150",fluid:""},null,8,["modelValue"])]),s("div",ue,[s("div",me,[e[18]||(e[18]=s("label",{class:"block font-bold mb-3"},[s("small",null,"Dejar vacío para mantener la actual")],-1)),r(t(ee),{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=l=>b.value=l),toggleMask:"",placeholder:"Nueva contraseña",feedback:!1,inputId:"password",fluid:""},null,8,["modelValue"])]),s("div",ce,[e[19]||(e[19]=s("label",{class:"block font-bold mb-3"},[n("Rol "),s("span",{class:"text-red-500"},"*")],-1)),r(t(ae),{modelValue:a.value.role_id,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.role_id=l),options:$.value,optionLabel:"name",optionValue:"id",placeholder:"Seleccione un rol",class:"w-full",filter:"",filterPlaceholder:"Buscar rol"},null,8,["modelValue","options"]),w.value&&!a.value.role_id?(N(),C("small",pe,"El rol es obligatorio.")):g.value.role_id?(N(),C("small",ve,Q(g.value.role_id[0]),1)):J("",!0)])])])]),_:1},8,["visible"]))}});export{we as _};
