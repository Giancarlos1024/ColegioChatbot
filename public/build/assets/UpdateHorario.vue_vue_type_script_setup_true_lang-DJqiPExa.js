import{s as R}from"./index-Bd5u6C13.js";import{s as B}from"./index-CIJ9kEDP.js";import{s as _}from"./index-DWx6GgBR.js";import{s as T}from"./index-BsSS1dRr.js";import{s as W}from"./index-DTrYfW8t.js";import{s as N}from"./index-6IO2ceo-.js";import{d as J,aa as K,r as m,B as U,a2 as F,e as M,a as r,w as P,g as t,b as n,c as i,j as d,i as h,f as c,n as E,t as y}from"./app-CSI2DTQR.js";const O={class:"flex flex-col gap-6"},Q={class:"grid grid-cols-12 gap-4"},X={class:"col-span-12 md:col-span-4"},Y={key:0,class:"text-red-500"},Z={key:1,class:"text-red-500"},D={class:"col-span-12 md:col-span-4"},ee={key:0,class:"text-red-500"},ae={key:1,class:"text-red-500"},le={class:"col-span-12 md:col-span-4"},se={key:0,class:"text-red-500"},te={key:1,class:"text-red-500"},oe={class:"col-span-12 md:col-span-6"},re={key:0,class:"text-red-500"},ie={key:1,class:"text-red-500"},de={class:"col-span-12 md:col-span-6"},ce={key:0,class:"text-red-500"},ne={key:1,class:"text-red-500"},ue={class:"col-span-12"},me={class:"flex items-center gap-3"},pe={key:0,class:"text-red-500"},ve={class:"flex flex-col sm:flex-row gap-2 w-full sm:justify-end"},ge=J({__name:"UpdateHorario",props:{visible:{type:Boolean},scheduleId:{}},emits:["update:visible","updated"],setup(H,{emit:L}){const b=H,I=L,p=K(),v=m(b.visible),x=m(!1),f=m(!1),o=m({}),l=m({fechaFormatted:"",fechaInicioFormatted:"",fechaFinFormatted:"",idEspacio:null,idEmpleado:null,state:!1}),w=m([]),S=m([]);U(()=>b.visible,a=>{v.value=a,a&&b.scheduleId&&(q(),A(),j())}),U(v,a=>I("update:visible",a));const z=a=>{if(!a)return"";console.log("Convirtiendo fecha simple:",a);try{if(a.includes("/")){const[e,s,u]=a.split("/");return`${u}-${s.padStart(2,"0")}-${e.padStart(2,"0")}`}else if(a.includes("-")){const[e,s,u]=a.split("-");return`${u}-${s.padStart(2,"0")}-${e.padStart(2,"0")}`}return""}catch(e){return console.error("Error converting date:",a,e),""}},C=a=>{if(!a)return"";console.log("Convirtiendo fecha y hora:",a);try{if(a.includes("/")&&a.includes(":")){const[e,s]=a.split(" "),[u,g,V]=e.split("/"),[$,k]=s.split(":");return`${V}-${g.padStart(2,"0")}-${u.padStart(2,"0")}T${$.padStart(2,"0")}:${k}`}else if(a.includes("-")&&a.includes(":")){const[e,s]=a.split(" "),[u,g,V]=e.split("-"),[$,k]=s.split(":");return`${V}-${g.padStart(2,"0")}-${u.padStart(2,"0")}T${$.padStart(2,"0")}:${k}`}return""}catch(e){return console.error("Error converting date time:",a,e),""}},q=async()=>{try{x.value=!0;const e=(await F.get(`/horario/${b.scheduleId}`)).data.schedule;console.log("Datos completos recibidos del API:",e),l.value={fechaFormatted:z(e.fecha),fechaInicioFormatted:C(e.fechaInicio),fechaFinFormatted:C(e.fechaFin),idEspacio:e.idEspacio,idEmpleado:e.idEmpleado,state:e.state},console.log("Datos después de conversión:",l.value)}catch(a){p.add({severity:"error",summary:"Error",detail:"No se pudo cargar el horario",life:3e3}),console.error("Error fetching schedule:",a)}finally{x.value=!1}},A=async()=>{try{const a=await F.get("/espacio",{params:{state:1}});w.value=a.data.data}catch{p.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los espacios",life:3e3})}},j=async()=>{try{const a=await F.get("/empleado",{params:{state:1}});S.value=a.data.data.map(e=>({...e,nameFull:e.name+" "+e.apellido}))}catch{p.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los empleados",life:3e3})}},G=async()=>{var a,e;if(f.value=!0,o.value={},!(!l.value.fechaFormatted||!l.value.fechaInicioFormatted||!l.value.fechaFinFormatted||!l.value.idEspacio||!l.value.idEmpleado))try{const s={fecha:l.value.fechaFormatted,fechaInicio:l.value.fechaInicioFormatted.replace("T"," ")+":00",fechaFin:l.value.fechaFinFormatted.replace("T"," ")+":00",idEspacio:l.value.idEspacio,idEmpleado:l.value.idEmpleado,state:l.value.state};await F.put(`/horario/${b.scheduleId}`,s),p.add({severity:"success",summary:"Actualizado",detail:"Horario actualizado correctamente",life:3e3}),v.value=!1,I("updated")}catch(s){(e=(a=s.response)==null?void 0:a.data)!=null&&e.errors?(o.value=s.response.data.errors,p.add({severity:"error",summary:"Error de validación",detail:"Revisa los campos e intenta nuevamente.",life:5e3})):p.add({severity:"error",summary:"Error",detail:"No se pudo actualizar el horario",life:3e3}),console.error("Error updating schedule:",s)}};return(a,e)=>(r(),M(c(R),{visible:v.value,"onUpdate:visible":e[7]||(e[7]=s=>v.value=s),header:"Editar Horario",modal:"",closable:!0,style:{width:"95vw",maxWidth:"700px"}},{footer:P(()=>[t("div",ve,[n(c(B),{label:"Cancelar",icon:"pi pi-times",text:"",class:"w-full sm:w-auto",onClick:e[6]||(e[6]=s=>v.value=!1)}),n(c(B),{label:"Guardar",icon:"pi pi-check",onClick:G,loading:x.value,class:"w-full sm:w-auto"},null,8,["loading"])])]),default:P(()=>[t("div",O,[t("div",Q,[t("div",X,[e[8]||(e[8]=t("label",{class:"block font-bold mb-2"},[h("Fecha "),t("span",{class:"text-red-500"},"*")],-1)),n(c(_),{modelValue:l.value.fechaFormatted,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.fechaFormatted=s),type:"date",required:"",fluid:"",class:E(["w-full",{"p-invalid":o.value.fecha}])},null,8,["modelValue","class"]),f.value&&!l.value.fechaFormatted?(r(),i("small",Y,"La fecha es obligatoria.")):d("",!0),o.value.fecha?(r(),i("small",Z,y(o.value.fecha[0]),1)):d("",!0)]),t("div",D,[e[9]||(e[9]=t("label",{class:"block font-bold mb-2"},[h("Fecha y Hora Inicio "),t("span",{class:"text-red-500"},"*")],-1)),n(c(_),{modelValue:l.value.fechaInicioFormatted,"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.fechaInicioFormatted=s),type:"datetime-local",required:"",fluid:"",class:E(["w-full",{"p-invalid":o.value.fechaInicio}])},null,8,["modelValue","class"]),f.value&&!l.value.fechaInicioFormatted?(r(),i("small",ee,"La fecha de inicio es obligatoria.")):d("",!0),o.value.fechaInicio?(r(),i("small",ae,y(o.value.fechaInicio[0]),1)):d("",!0)]),t("div",le,[e[10]||(e[10]=t("label",{class:"block font-bold mb-2"},[h("Fecha y Hora Fin "),t("span",{class:"text-red-500"},"*")],-1)),n(c(_),{modelValue:l.value.fechaFinFormatted,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.fechaFinFormatted=s),type:"datetime-local",required:"",fluid:"",class:E(["w-full",{"p-invalid":o.value.fechaFin}])},null,8,["modelValue","class"]),f.value&&!l.value.fechaFinFormatted?(r(),i("small",se,"La fecha de fin es obligatoria.")):d("",!0),o.value.fechaFin?(r(),i("small",te,y(o.value.fechaFin[0]),1)):d("",!0)]),t("div",oe,[e[11]||(e[11]=t("label",{class:"block font-bold mb-2"},[h("Espacio "),t("span",{class:"text-red-500"},"*")],-1)),n(c(N),{modelValue:l.value.idEspacio,"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.idEspacio=s),options:w.value,optionLabel:"name",optionValue:"id",placeholder:"Seleccione un espacio",fluid:"",filter:"",filterPlaceholder:"Buscar espacio",class:E(["w-full",{"p-invalid":o.value.idEspacio}])},null,8,["modelValue","options","class"]),f.value&&!l.value.idEspacio?(r(),i("small",re,"Debe seleccionar un espacio.")):d("",!0),o.value.idEspacio?(r(),i("small",ie,y(o.value.idEspacio[0]),1)):d("",!0)]),t("div",de,[e[12]||(e[12]=t("label",{class:"block font-bold mb-2"},[h("Empleado "),t("span",{class:"text-red-500"},"*")],-1)),n(c(N),{modelValue:l.value.idEmpleado,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.idEmpleado=s),options:S.value,optionLabel:"nameFull",optionValue:"id",placeholder:"Seleccione un empleado",fluid:"",filter:"",filterPlaceholder:"Buscar empleado",class:E(["w-full",{"p-invalid":o.value.idEmpleado}])},null,8,["modelValue","options","class"]),f.value&&!l.value.idEmpleado?(r(),i("small",ce,"Debe seleccionar un empleado.")):d("",!0),o.value.idEmpleado?(r(),i("small",ne,y(o.value.idEmpleado[0]),1)):d("",!0)]),t("div",ue,[e[13]||(e[13]=t("label",{class:"block font-bold mb-2"},[h("Estado "),t("span",{class:"text-red-500"},"*")],-1)),t("div",me,[n(c(T),{modelValue:l.value.state,"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.state=s),binary:!0},null,8,["modelValue"]),n(c(W),{value:l.value.state?"Activo":"Inactivo",severity:l.value.state?"success":"danger"},null,8,["value","severity"])]),o.value.state?(r(),i("small",pe,y(o.value.state[0]),1)):d("",!0)])])])]),_:1},8,["visible"]))}});export{ge as _};
