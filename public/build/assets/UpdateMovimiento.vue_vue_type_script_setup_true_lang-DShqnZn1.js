import{d as G,r as u,aa as H,B as T,a2 as k,e as W,a as n,w as P,g as i,b as r,c,j as d,i as S,f as t,n as v,t as f}from"./app-CSI2DTQR.js";import{s as q}from"./index-Bd5u6C13.js";import{s as $}from"./index-CIJ9kEDP.js";import{s as h}from"./index-DWx6GgBR.js";import{s as M}from"./index-BsSS1dRr.js";import{s as U}from"./index-6IO2ceo-.js";const J={class:"flex flex-col gap-6"},K={class:"grid grid-cols-12 gap-4"},O={class:"col-span-12"},Q={key:0,class:"text-red-500"},X={key:1,class:"text-red-500"},Y={class:"col-span-12"},Z={key:0,class:"text-red-500"},ee={key:1,class:"text-red-500"},oe={class:"col-span-12 sm:col-span-6 flex items-center gap-2"},le={class:"col-span-12 sm:col-span-6 flex items-center gap-2"},ae={class:"col-span-12"},se={key:0,class:"text-red-500"},ie={class:"col-span-12"},te={key:0,class:"text-red-500"},re={class:"col-span-12"},ne={key:0,class:"text-red-500"},ce={class:"col-span-12"},de={key:0,class:"text-red-500"},ye=G({__name:"UpdateMovimiento",props:{visible:{type:Boolean},movimientoId:{}},emits:["update:visible","updated"],setup(C,{emit:_}){const B=u([{label:"Cara",value:1},{label:"Huella",value:2}]),b=C,R=_,m=u(b.visible),y=u(!1),x=u(!1),s=u({}),w=u([]),l=u({idEspacio:null,idTipo:null,reconocido:!1,access:!1,error:"",fechaEnvioESP32:"",fechaRecepcion:"",fechaReconocimiento:""}),p=H();T(()=>b.visible,a=>{m.value=a,a&&b.movimientoId&&(I(),N())}),T(m,a=>R("update:visible",a));const g=a=>{if(!a)return"";const[e,o,E]=a.split(" "),[A,D,F]=e.split("-");let[L,j]=o.split(":"),V=parseInt(L,10);return E==="PM"&&V<12&&(V+=12),E==="AM"&&V===12&&(V=0),`${F}-${D}-${A}T${V.toString().padStart(2,"0")}:${j}`},I=async()=>{try{y.value=!0;const a=await k.get(`/movimiento/${b.movimientoId}`);if(!a.data||!a.data.movement){p.add({severity:"error",summary:"Error",detail:"Movimiento no encontrado",life:3e3});return}const e=a.data.movement;l.value={idEspacio:e.idEspacio??null,idTipo:e.idTipo??null,reconocido:e.reconocido??!1,access:e.access??!1,error:e.error??"",fechaEnvioESP32:g(e.fechaEnvioESP32),fechaRecepcion:g(e.fechaRecepcion),fechaReconocimiento:g(e.fechaReconocimiento)}}catch(a){p.add({severity:"error",summary:"Error",detail:"No se pudo cargar el movimiento",life:3e3}),console.error(a)}finally{y.value=!1}},N=async()=>{try{const a=await k.get("/espacio",{params:{state:1}});w.value=a.data.data}catch(a){p.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los espacios",life:3e3}),console.error(a)}},z=async()=>{var a,e;if(x.value=!0,s.value={},!(!l.value.idEspacio||!l.value.idTipo))try{y.value=!0,await k.put(`/movimiento/${b.movimientoId}`,l.value),p.add({severity:"success",summary:"Actualizado",detail:"Movimiento actualizado correctamente",life:3e3}),m.value=!1,R("updated")}catch(o){const E=o;(e=(a=E.response)==null?void 0:a.data)!=null&&e.errors?(s.value=E.response.data.errors,p.add({severity:"error",summary:"Error de validación",detail:"Revisa los campos e intenta nuevamente",life:5e3})):p.add({severity:"error",summary:"Error",detail:"No se pudo actualizar el movimiento",life:3e3}),console.error(o)}finally{y.value=!1}};return(a,e)=>(n(),W(t(q),{visible:m.value,"onUpdate:visible":e[9]||(e[9]=o=>m.value=o),header:"Editar Movimiento",modal:!0,class:"w-full max-w-full sm:max-w-lg",style:{width:"95vw",maxWidth:"600px"}},{footer:P(()=>[r(t($),{label:"Cancelar",icon:"pi pi-times",text:"",class:"mr-2",onClick:e[8]||(e[8]=o=>m.value=!1)}),r(t($),{label:"Guardar",icon:"pi pi-check",onClick:z,loading:y.value},null,8,["loading"])]),default:P(()=>[i("div",J,[i("div",K,[i("div",O,[e[10]||(e[10]=i("label",{class:"block font-bold mb-2"},[S("Espacio "),i("span",{class:"text-red-500"},"*")],-1)),r(t(U),{modelValue:l.value.idEspacio,"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.idEspacio=o),options:w.value,optionLabel:"name",optionValue:"id",placeholder:"Seleccione un espacio",class:v(["w-full",{"p-invalid":s.value.idEspacio}]),filter:"",filterPlaceholder:"Buscar espacio"},null,8,["modelValue","options","class"]),x.value&&!l.value.idEspacio?(n(),c("small",Q,"Debe seleccionar un espacio.")):d("",!0),s.value.idEspacio?(n(),c("small",X,f(s.value.idEspacio[0]),1)):d("",!0)]),i("div",Y,[e[11]||(e[11]=i("label",{class:"block font-bold mb-2"},[S("Tipo "),i("span",{class:"text-red-500"},"*")],-1)),r(t(U),{modelValue:l.value.idTipo,"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.idTipo=o),options:B.value,optionLabel:"label",optionValue:"value",placeholder:"Seleccione un tipo",class:v(["w-full",{"p-invalid":s.value.idTipo}])},null,8,["modelValue","options","class"]),x.value&&!l.value.idTipo?(n(),c("small",Z,"El tipo es obligatorio.")):d("",!0),s.value.idTipo?(n(),c("small",ee,f(s.value.idTipo[0]),1)):d("",!0)]),i("div",oe,[r(t(M),{modelValue:l.value.reconocido,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.reconocido=o),binary:!0},null,8,["modelValue"]),e[12]||(e[12]=i("label",{class:"font-bold"},"Reconocido",-1))]),i("div",le,[r(t(M),{modelValue:l.value.access,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.access=o),binary:!0},null,8,["modelValue"]),e[13]||(e[13]=i("label",{class:"font-bold"},"Acceso",-1))]),i("div",ae,[e[14]||(e[14]=i("label",{class:"block font-bold mb-2"},"Error",-1)),r(t(h),{modelValue:l.value.error,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.error=o),modelModifiers:{trim:!0},maxlength:"3",placeholder:"Ingrese código de error",class:v(["w-full",{"p-invalid":s.value.error}])},null,8,["modelValue","class"]),s.value.error?(n(),c("small",se,f(s.value.error[0]),1)):d("",!0)]),i("div",ie,[e[15]||(e[15]=i("label",{class:"block font-bold mb-2"},"Fecha Envío ESP32",-1)),r(t(h),{type:"datetime-local",modelValue:l.value.fechaEnvioESP32,"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.fechaEnvioESP32=o),class:v(["w-full",{"p-invalid":s.value.fechaEnvioESP32}])},null,8,["modelValue","class"]),s.value.fechaEnvioESP32?(n(),c("small",te,f(s.value.fechaEnvioESP32[0]),1)):d("",!0)]),i("div",re,[e[16]||(e[16]=i("label",{class:"block font-bold mb-2"},"Fecha Recepción",-1)),r(t(h),{type:"datetime-local",modelValue:l.value.fechaRecepcion,"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.fechaRecepcion=o),class:v(["w-full",{"p-invalid":s.value.fechaRecepcion}])},null,8,["modelValue","class"]),s.value.fechaRecepcion?(n(),c("small",ne,f(s.value.fechaRecepcion[0]),1)):d("",!0)]),i("div",ce,[e[17]||(e[17]=i("label",{class:"block font-bold mb-2"},"Fecha Reconocimiento",-1)),r(t(h),{type:"datetime-local",modelValue:l.value.fechaReconocimiento,"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.fechaReconocimiento=o),class:v(["w-full",{"p-invalid":s.value.fechaReconocimiento}])},null,8,["modelValue","class"]),s.value.fechaReconocimiento?(n(),c("small",de,f(s.value.fechaReconocimiento[0]),1)):d("",!0)])])])]),_:1},8,["visible"]))}});export{ye as _};
