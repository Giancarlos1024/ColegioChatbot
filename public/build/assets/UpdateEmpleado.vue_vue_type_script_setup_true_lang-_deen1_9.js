import{s as z}from"./index-Bd5u6C13.js";import{s as V}from"./index-DWx6GgBR.js";import{s as b}from"./index-CIJ9kEDP.js";import{s as M}from"./index-BsSS1dRr.js";import{s as W}from"./index-DTrYfW8t.js";import{s as G}from"./index-6IO2ceo-.js";import{d as q,aa as J,r as p,B as $,a2 as U,e as K,a as i,w as B,g as o,b as u,c as d,j as r,i as _,f as n,t as y}from"./app-CSI2DTQR.js";const Q={class:"flex flex-col gap-6"},X={class:"grid grid-cols-12 gap-4"},Y={class:"col-span-12 sm:col-span-6"},Z={key:0,class:"text-red-500"},ee={key:1,class:"text-red-500"},le={class:"col-span-12 sm:col-span-6"},ae={key:0,class:"text-red-500"},oe={key:1,class:"text-red-500"},te={class:"col-span-12 sm:col-span-6"},se={key:0,class:"text-red-500"},ie={key:1,class:"text-red-500"},de={class:"col-span-12 sm:col-span-6"},re={key:0,class:"text-red-500"},ne={key:1,class:"text-red-500"},ue={class:"col-span-12"},pe={key:0,class:"text-red-500"},ce={key:1,class:"text-red-500"},me={class:"col-span-12 flex items-center gap-3"},ve={key:0,class:"text-red-500"},fe={class:"col-span-12"},ye={class:"mt-2 flex flex-wrap gap-2"},ge={key:0,class:"mt-2 flex flex-col gap-2 items-center"},be={class:"flex gap-2 flex-wrap mt-2"},_e={key:1,class:"mt-2 flex flex-col gap-2 items-center"},xe=["src"],he={key:2,class:"text-red-500"},ke={key:3,class:"text-red-500"},He=q({__name:"UpdateEmpleado",props:{visible:{type:Boolean},empleadoId:{}},emits:["update:visible","updated"],setup(T,{emit:L}){const x=T,D=L,v=J(),g=p(x.visible),h=p(!1),c=p(!1),s=p({}),l=p({name:"",apellido:"",codigo:"",employee_type_id:null,idHuella:"",foto:null,state:!0}),H=p([]),m=p(null),E=p(!1),f=p(null);let k=null,C=null;$(()=>x.visible,a=>{g.value=a,a&&x.empleadoId&&(R(),j())}),$(g,a=>{a||P(),D("update:visible",a)});function P(){l.value.foto=null,m.value=C,s.value={},c.value=!1,I()}async function R(){try{h.value=!0;const e=(await U.get(`/empleado/${x.empleadoId}`)).data.employee;l.value={name:e.name,apellido:e.apellido,codigo:e.codigo,employee_type_id:e.employee_type_id,idHuella:e.idHuella??"",foto:null,state:e.state},C=e.foto?`/uploads/fotos/empleados/${e.foto}`:null,m.value=C}catch(a){v.add({severity:"error",summary:"Error",detail:"No se pudo cargar el empleado",life:3e3}),console.error(a)}finally{h.value=!1}}async function j(){try{const a=await U.get("/tipo_empleado",{params:{state:1}});H.value=a.data.data}catch(a){v.add({severity:"error",summary:"Error",detail:"No se pudo cargar los tipos de empleado",life:3e3}),console.error(a)}}function F(a){var w;const t=((w=a.target.files)==null?void 0:w[0])??null;t&&(l.value.foto=t,m.value=URL.createObjectURL(t))}function N(){navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{k=a,E.value=!0,f.value&&(f.value.srcObject=k)}).catch(()=>{v.add({severity:"error",summary:"Error",detail:"No se pudo acceder a la cámara",life:3e3})})}function I(){k&&(k.getTracks().forEach(a=>a.stop()),k=null),E.value=!1}function A(){if(!f.value)return;const a=document.createElement("canvas");a.width=f.value.videoWidth,a.height=f.value.videoHeight;const e=a.getContext("2d");e&&(e.drawImage(f.value,0,0,a.width,a.height),a.toBlob(t=>{if(!t)return;const w=new File([t],`empleado_${Date.now()}.png`,{type:"image/png"});l.value.foto=w,m.value=URL.createObjectURL(w),I()},"image/png"))}function O(){m.value=null,l.value.foto=null,N()}async function S(){if(c.value=!0,s.value={},!l.value.name||!l.value.codigo||!l.value.employee_type_id){v.add({severity:"warn",summary:"Campos incompletos",detail:"Complete todos los campos obligatorios",life:3e3});return}const a=new FormData;a.append("_method","PUT"),a.append("name",l.value.name),a.append("apellido",l.value.apellido),a.append("idHuella",String(l.value.idHuella)),a.append("codigo",l.value.codigo),a.append("employee_type_id",String(l.value.employee_type_id)),a.append("state",l.value.state?"1":"0"),l.value.foto&&a.append("foto",l.value.foto);try{h.value=!0,await U.post(`/empleado/${x.empleadoId}`,a,{headers:{"Content-Type":"multipart/form-data"}}),v.add({severity:"success",summary:"Actualizado",detail:"Empleado actualizado correctamente",life:3e3}),g.value=!1,D("updated")}catch(e){const t=e;t.response&&t.response.status===422?(s.value=t.response.data.errors||{},v.add({severity:"error",summary:"Error de validación",detail:"Revisa los campos e intenta nuevamente",life:5e3})):v.add({severity:"error",summary:"Error",detail:"No se pudo actualizar el empleado",life:3e3}),console.error(e)}finally{h.value=!1}}return(a,e)=>(i(),K(n(z),{visible:g.value,"onUpdate:visible":e[7]||(e[7]=t=>g.value=t),header:"Editar Empleado",modal:"",closable:!0,style:{width:"90%",maxWidth:"650px"}},{footer:B(()=>[u(n(b),{label:"Cancelar",icon:"pi pi-times",text:"",onClick:e[6]||(e[6]=t=>g.value=!1)}),u(n(b),{label:"Guardar",icon:"pi pi-check",onClick:S,loading:h.value},null,8,["loading"])]),default:B(()=>[o("div",Q,[o("div",X,[o("div",Y,[e[8]||(e[8]=o("label",{class:"block font-bold mb-2"},[_("Nombre "),o("span",{class:"text-red-500"},"*")],-1)),u(n(V),{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.name=t),placeholder:"Ingrese su nombre",maxlength:"150",class:"w-full"},null,8,["modelValue"]),c.value&&!l.value.name?(i(),d("small",Z,"El nombre es obligatorio.")):r("",!0),s.value.name?(i(),d("small",ee,y(s.value.name[0]),1)):r("",!0)]),o("div",le,[e[9]||(e[9]=o("label",{class:"block font-bold mb-2"},[_("Apellido "),o("span",{class:"text-red-500"},"*")],-1)),u(n(V),{modelValue:l.value.apellido,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.apellido=t),placeholder:"Ingrese su apellido",maxlength:"150",class:"w-full"},null,8,["modelValue"]),c.value&&!l.value.apellido?(i(),d("small",ae,"El apellido es obligatorio.")):r("",!0),s.value.apellido?(i(),d("small",oe,y(s.value.apellido[0]),1)):r("",!0)]),o("div",te,[e[10]||(e[10]=o("label",{class:"block font-bold mb-2"},[_("DNI "),o("span",{class:"text-red-500"},"*")],-1)),u(n(V),{modelValue:l.value.codigo,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.codigo=t),placeholder:"Ingrese su DNI",maxlength:"8",class:"w-full"},null,8,["modelValue"]),c.value&&!l.value.codigo?(i(),d("small",se,"El DNI es obligatorio.")):r("",!0),s.value.codigo?(i(),d("small",ie,y(s.value.codigo[0]),1)):r("",!0)]),o("div",de,[e[11]||(e[11]=o("label",{class:"block font-bold mb-2"},[_("ID Huella "),o("span",{class:"text-red-500"},"*")],-1)),u(n(V),{modelValue:l.value.idHuella,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.idHuella=t),modelModifiers:{number:!0},placeholder:"Ingrese ID de huella",class:"w-full"},null,8,["modelValue"]),c.value&&!l.value.idHuella?(i(),d("small",re,"El ID de huella es obligatorio.")):r("",!0),s.value.idHuella?(i(),d("small",ne,y(s.value.idHuella[0]),1)):r("",!0)]),o("div",ue,[e[12]||(e[12]=o("label",{class:"block font-bold mb-2"},[_("Tipo de Empleado "),o("span",{class:"text-red-500"},"*")],-1)),u(n(G),{modelValue:l.value.employee_type_id,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.employee_type_id=t),options:H.value,optionLabel:"name",optionValue:"id",placeholder:"Seleccione tipo de empleado",class:"w-full",filter:"",filterPlaceholder:"Buscar tipo de empleado"},null,8,["modelValue","options"]),c.value&&!l.value.employee_type_id?(i(),d("small",pe,"Debe seleccionar un tipo.")):r("",!0),s.value.employee_type_id?(i(),d("small",ce,y(s.value.employee_type_id[0]),1)):r("",!0)]),o("div",me,[u(n(M),{modelValue:l.value.state,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.state=t),binary:!0},null,8,["modelValue"]),u(n(W),{value:l.value.state?"Activo":"Inactivo",severity:l.value.state?"success":"danger"},null,8,["value","severity"]),s.value.state?(i(),d("small",ve,y(s.value.state[0]),1)):r("",!0)]),o("div",fe,[e[13]||(e[13]=o("label",{class:"block font-bold mb-2"},[_("Foto "),o("span",{class:"text-red-500"},"*")],-1)),o("input",{type:"file",onChange:F,class:"w-full",accept:"image/png, image/jpeg"},null,32),o("div",ye,[u(n(b),{label:"Tomar Foto",icon:"pi pi-camera",class:"p-button-secondary",onClick:N})]),E.value?(i(),d("div",ge,[o("video",{ref_key:"video",ref:f,autoplay:"",playsinline:"",class:"w-full max-w-xs"},null,512),o("div",be,[u(n(b),{label:"Capturar",icon:"pi pi-check",class:"p-button-success",onClick:A}),u(n(b),{label:"Cancelar",icon:"pi pi-times",class:"p-button-danger",onClick:I})])])):r("",!0),m.value?(i(),d("div",_e,[o("img",{src:m.value,alt:"Preview",class:"w-full max-w-xs h-auto border rounded"},null,8,xe),u(n(b),{label:"Reintentar",icon:"pi pi-refresh",class:"p-button-warning",onClick:O})])):r("",!0),c.value&&!l.value.foto&&!m.value?(i(),d("small",he,"La foto es obligatoria.")):r("",!0),s.value.foto?(i(),d("small",ke,y(s.value.foto[0]),1)):r("",!0)])])])]),_:1},8,["visible"]))}});export{He as _};
