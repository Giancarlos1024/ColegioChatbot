import{d as V,aa as I,r as _,o as T,c as r,a as i,b as d,f as u,h as q,w as D,g as e,F as f,X as b,j,n as P,t as l,U as S,a2 as g}from"./app-CSI2DTQR.js";import{_ as z}from"./AppLayout.vue_vue_type_script_setup_true_lang-BX3xEzoN.js";import{s as h}from"./index-CIJ9kEDP.js";import{s as F}from"./index-DWx6GgBR.js";import"./AppConfigurator.vue_vue_type_script_setup_true_lang-DpDyjPj6.js";import"./index-D_KOsQEr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const M={class:"p-4 grid grid-cols-12 gap-4 h-full"},Q={class:"col-span-12 lg:col-span-8 flex flex-col h-[70vh]"},R={class:"flex-1 border rounded-lg p-3 overflow-y-auto bg-surface-100"},B={key:1,class:"bg-surface-0 text-gray-900 rounded-lg p-3"},K={class:"font-semibold mb-2"},L={key:0,class:"space-y-2 max-h-64 overflow-y-auto"},U={class:"flex justify-between items-center"},O={class:"font-semibold text-sm"},X={class:"text-xs px-2 py-1 rounded-full bg-primary/10 text-primary"},Y={class:"text-xs text-gray-500"},G={class:"text-xs text-gray-500"},J={class:"flex justify-end mt-1"},W={key:1,class:"text-sm text-gray-500"},Z={key:2,class:"bg-surface-0 text-gray-900 rounded-lg p-3"},ee={class:"font-semibold mb-2"},te={key:0,class:"space-y-2 max-h-64 overflow-y-auto"},se={class:"font-semibold text-sm"},ae={class:"text-xs text-gray-700"},oe={class:"text-[11px] text-gray-500 mt-1"},le={key:1,class:"text-sm text-gray-500"},re={class:"mt-3"},ie={class:"flex gap-2 mb-2"},ne={class:"flex gap-2"},ce={class:"col-span-12 lg:col-span-4 space-y-4"},de={class:"border rounded-lg p-4"},ue={class:"text-sm"},pe={class:"text-sm"},me={class:"text-sm"},ye={class:"border rounded-lg p-4"},he={class:"text-sm space-y-1"},Ce=V({__name:"indexAsistent",setup(fe){const x=I(),n=_([{from:"bot",type:"text",text:"Hola, soy tu asistente. ¿En qué te ayudo hoy?"}]),m=_(""),p=_({talleresHoy:0,alertasHoy:0,proximoHorario:"—"});function v(){const a=new Date,t=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),c=String(a.getDate()).padStart(2,"0");return`${t}-${s}-${c}`}function E(a){try{const t=new Date(v()),s=new Date(a.fecha_inicio),c=new Date(a.fecha_fin);return s<=t&&t<=c}catch{return!1}}T(async()=>{await $()});function k(){m.value.trim()&&(n.value.push({from:"user",type:"text",text:m.value}),n.value.push({from:"bot",type:"text",text:"Por ahora respondo acciones rápidas: Talleres de hoy, Alertas activas e inscripciones."}),m.value="")}async function y(a){a==="talleres_hoy"?(n.value.push({from:"user",type:"text",text:"Quiero ver los talleres de hoy"}),await C()):a==="alertas_activas"?(n.value.push({from:"user",type:"text",text:"Quiero ver las alertas activas de hoy"}),await H()):a==="mis_horarios"&&(n.value.push({from:"user",type:"text",text:"Quiero ver mis horarios"}),n.value.push({from:"bot",type:"text",text:'La vista de horarios sigue disponible en el menú "Horarios". Pronto la integraré aquí.'}))}function w(a){a==="inscribirme_taller"?(n.value.push({from:"bot",type:"text",text:'Para inscribirte, primero veamos los talleres disponibles hoy y luego haz clic en "Inscribirme" en el taller que elijas.'}),y("talleres_hoy")):a==="ver_alertas"&&(n.value.push({from:"bot",type:"text",text:"Te muestro las alertas registradas para el día de hoy."}),y("alertas_activas"))}async function C(){try{const a=await g.get("/asistente/talleres-hoy"),s=(a.data.data??a.data??[]).filter(E).slice(0,10);n.value.push({from:"bot",type:"talleres",text:`Estos son los talleres que se dictan hoy (${v()}):`,talleres:s}),p.value.talleresHoy=s.length}catch(a){console.error(a),n.value.push({from:"bot",type:"text",text:"No pude cargar los talleres de hoy. Inténtalo nuevamente más tarde."})}}async function H(){try{const a=v(),t=await g.get("/asistente/alertas-hoy"),s=t.data.data??t.data??[];n.value.push({from:"bot",type:"alertas",text:`Estas son las alertas registradas para hoy (${a}):`,alertas:s}),p.value.alertasHoy=s.length}catch(a){console.error(a),n.value.push({from:"bot",type:"text",text:"No pude cargar las alertas de hoy. Inténtalo nuevamente más tarde."})}}async function N(a){var t,s,c;try{const o=await g.post("/inscripciones",{taller_id:a});(t=o.data)!=null&&t.state?(x.add({severity:"success",summary:"Inscripción exitosa",detail:o.data.message||"Te has inscrito correctamente en el taller.",life:4e3}),await $()):x.add({severity:"warn",summary:"Advertencia",detail:o.data.message||"No se pudo completar la inscripción.",life:4e3})}catch(o){const A=((c=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:c.message)??"No se pudo completar la inscripción. Verifica que tengas permisos o que el taller tenga cupos.";x.add({severity:"error",summary:"Error de inscripción",detail:A,life:5e3}),console.error("Error al inscribirse:",o)}}async function $(){try{const[a,t]=await Promise.all([C(),H()]);p.value.proximoHorario="Revisa la sección Horarios para más detalle."}catch{}}return(a,t)=>(i(),r(f,null,[d(u(q),{title:"Asistente"}),d(z,null,{default:D(()=>[e("div",M,[e("div",Q,[t[6]||(t[6]=e("h2",{class:"text-2xl font-bold mb-4"},"Asistente IA",-1)),e("div",R,[(i(!0),r(f,null,b(n.value,(s,c)=>(i(),r("div",{key:c,class:"mb-3"},[s.type==="text"?(i(),r("div",{key:0,class:P(["inline-block px-3 py-2 rounded-lg max-w-full",s.from==="user"?"bg-primary text-white ml-auto":"bg-surface-0 text-gray-900"])},l(s.text),3)):s.type==="talleres"?(i(),r("div",B,[e("p",K,l(s.text),1),s.talleres.length?(i(),r("div",L,[(i(!0),r(f,null,b(s.talleres,o=>(i(),r("div",{key:o.id,class:"border rounded p-2 flex flex-col gap-1"},[e("div",U,[e("span",O,l(o.nombre),1),e("span",X,l(o.turno),1)]),e("p",Y,l(o.fecha_inicio)+" al "+l(o.fecha_fin),1),e("p",G," Cupos: "+l(o.cupos_disponibles??"—")+" · Estado: "+l(o.estado??"—"),1),e("div",J,[d(u(h),{label:"Inscribirme",icon:"pi pi-check",onClick:A=>N(o.id)},null,8,["onClick"])])]))),128))])):(i(),r("p",W," No hay talleres para hoy. "))])):s.type==="alertas"?(i(),r("div",Z,[e("p",ee,l(s.text),1),s.alertas.length?(i(),r("div",te,[(i(!0),r(f,null,b(s.alertas,o=>(i(),r("div",{key:o.id,class:"border-l-4 border-yellow-500 bg-yellow-50 rounded p-2"},[e("p",se,l(o.titulo),1),e("p",ae,l(o.descripcion),1),e("p",oe," Fecha: "+l(o.fecha),1)]))),128))])):(i(),r("p",le," No hay alertas para hoy. "))])):j("",!0)]))),128))]),e("div",re,[e("div",ie,[d(u(h),{label:"Talleres de hoy",size:"small",onClick:t[0]||(t[0]=s=>y("talleres_hoy"))}),d(u(h),{label:"Alertas activas",size:"small",onClick:t[1]||(t[1]=s=>y("alertas_activas"))}),d(u(h),{label:"Mis horarios",size:"small",onClick:t[2]||(t[2]=s=>y("mis_horarios"))})]),e("div",ne,[d(u(F),{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=s=>m.value=s),placeholder:"Escribe tu consulta (ej: ¿Cómo me inscribo a un taller?)",class:"flex-1",onKeyup:S(k,["enter"])},null,8,["modelValue"]),d(u(h),{icon:"pi pi-send",onClick:k})])])]),e("div",ce,[t[9]||(t[9]=e("div",{class:"border rounded-lg p-4"},[e("h3",{class:"font-semibold mb-2"},"Atajos útiles"),e("ul",{class:"text-sm space-y-1"},[e("li",null,"- Ver talleres de hoy"),e("li",null,"- Ver alertas activas"),e("li",null,"- Inscribirme a un taller disponible")])],-1)),e("div",de,[t[7]||(t[7]=e("h3",{class:"font-semibold mb-2"},"Resumen de hoy",-1)),e("p",ue,"Talleres de hoy: "+l(p.value.talleresHoy),1),e("p",pe,"Alertas de hoy: "+l(p.value.alertasHoy),1),e("p",me,"Próximo horario: "+l(p.value.proximoHorario),1)]),e("div",ye,[t[8]||(t[8]=e("h3",{class:"font-semibold mb-2"},"Preguntas frecuentes",-1)),e("ul",he,[e("li",{onClick:t[4]||(t[4]=s=>w("inscribirme_taller")),class:"cursor-pointer text-primary hover:underline"}," ¿Cómo me inscribo a un taller? "),e("li",{onClick:t[5]||(t[5]=s=>w("ver_alertas")),class:"cursor-pointer text-primary hover:underline"}," ¿Cómo veo las alertas del día? ")])])])])]),_:1})],64))}});export{Ce as default};
