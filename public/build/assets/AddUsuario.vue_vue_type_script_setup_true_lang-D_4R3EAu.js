import{d as W,aa as H,r as p,o as J,a2 as U,c as t,a as o,F as O,b as n,f as r,w as E,g as s,j as c,i as m,U as Q,n as X,t as v,e as h}from"./app-CSI2DTQR.js";import{s as Y}from"./index-Bd5u6C13.js";import{s as Z}from"./index-C_q0UAfk.js";import{s as f}from"./index-CIJ9kEDP.js";import{s as y}from"./index-DWx6GgBR.js";import{s as ee}from"./index-BsSS1dRr.js";import{s as le}from"./index-DTrYfW8t.js";import{s as se}from"./index-saBHE4wW.js";import{s as ae}from"./index-6IO2ceo-.js";const oe={class:"flex flex-col gap-6"},te={class:"grid grid-cols-1 sm:grid-cols-12 gap-4"},ie={class:"sm:col-span-9"},re={key:0,class:"text-red-500"},de={key:1,class:"text-red-500"},ne={key:2,class:"text-red-500"},ue={class:"sm:col-span-3 flex flex-col"},me={class:"flex items-center gap-3"},ce={key:0,class:"text-red-500"},ve={key:1,class:"text-red-500"},pe={key:0,class:"text-red-500"},fe={key:1,class:"text-red-500"},be={key:2,class:"text-red-500"},ge={key:0,class:"text-red-500"},ke={key:1,class:"text-red-500"},xe={key:2,class:"text-red-500"},ye={class:"grid grid-cols-1 sm:grid-cols-12 gap-4"},_e={class:"sm:col-span-6"},Ve={class:"mt-2 flex gap-2 flex-wrap"},we={key:0,class:"text-red-500"},Ne={key:1,class:"text-red-500"},he={class:"sm:col-span-6"},$e={class:"mt-2 flex gap-2 flex-wrap"},Ce={key:0,class:"text-red-500"},Ue={key:1,class:"text-red-500"},Ee={key:2,class:"text-red-500"},De={class:"grid grid-cols-1 sm:grid-cols-12 gap-4"},qe={class:"sm:col-span-6"},Ie={key:0,class:"text-red-500"},Le={key:1,class:"text-red-500"},ze={key:2,class:"text-red-500"},Ae={class:"sm:col-span-6"},Be={key:0,class:"text-red-500"},Me={key:1,class:"text-red-500"},Fe={class:"flex flex-col sm:flex-row gap-2 justify-end"},Oe=W({__name:"AddUsuario",emits:["usuario-agregado"],setup(Se,{emit:F}){const _=H(),D=p([]),d=p(!1),V=p(!1),i=p({}),S=F,b=p(!1),g=p(!1),$={dni:"",name:"",apellidos:"",nacimiento:"",email:"",username:"",password:"",status:!0,role_id:null},l=p({...$});function R(){d.value=!1,V.value=!0,l.value={...$},b.value=!1,g.value=!1}function q(){V.value=!1,d.value=!1,l.value={...$},b.value=!1,g.value=!1}function j(){const u=l.value.dni;u&&u.length===8&&U.get(`/consulta/${u}`).then(e=>{const a=e.data;if(a.success&&a.data){const{nombres:k="",apellido_paterno:x="",apellido_materno:w="",fecha_nacimiento:N=""}=a.data;l.value.name=k,l.value.apellidos=`${x} ${w}`.trim(),l.value.nacimiento=N,l.value.username=K(k,x,w,N)}else _.add({severity:"warn",summary:"No encontrado",detail:"No se encontraron datos para este DNI",life:3e3})}).catch(()=>{_.add({severity:"error",summary:"Error",detail:"No se pudo consultar el DNI",life:3e3})})}function K(u,e,a,k){var I,L,z,A,B,M;const x=C=>(C==null?void 0:C.replace(/ñ/g,"n").replace(/Ñ/g,"n").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase())||"",w=(I=x(u))==null?void 0:I.charAt(0),N=(L=x(e))==null?void 0:L.split(" ")[0],T=(A=(z=x(a))==null?void 0:z.split(" ")[0])==null?void 0:A.substring(0,2),G=((M=(B=k==null?void 0:k.split("/"))==null?void 0:B[0])==null?void 0:M.padStart(2,"0"))||"00";return`${w}${N}${T}${G}`.toUpperCase()}function P(){d.value=!0,i.value={},U.post("/usuarios",l.value).then(()=>{_.add({severity:"success",summary:"Éxito",detail:"Usuario registrado",life:3e3}),q(),S("usuario-agregado")}).catch(u=>{if(u.response&&u.response.status===422){const e=u.response.data.errors;i.value={dni:e.dni,name:e.name,apellidos:e.apellidos,nacimiento:e.nacimiento,email:e.email,password:e.password,status:e.status,role_id:e.role_id}}})}return J(()=>{U.get("/rol").then(u=>{D.value=u.data.data}).catch(()=>{_.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los roles",life:3e3})})}),(u,e)=>(o(),t(O,null,[n(r(Z),{class:"mb-6"},{start:E(()=>[n(r(f),{label:"Nuevo usuario",icon:"pi pi-plus",severity:"secondary",class:"mr-2",onClick:R})]),_:1}),n(r(Y),{visible:V.value,"onUpdate:visible":e[13]||(e[13]=a=>V.value=a),style:{width:"95vw",maxWidth:"600px"},header:"Registro de usuarios",modal:!0},{footer:E(()=>[s("div",Fe,[n(r(f),{label:"Cancelar",icon:"pi pi-times",text:"",onClick:q}),n(r(f),{label:"Guardar",icon:"pi pi-check",onClick:P})])]),default:E(()=>[s("div",oe,[s("div",te,[s("div",ie,[e[14]||(e[14]=s("label",{for:"dni",class:"block font-bold mb-3"},[m("DNI "),s("span",{class:"text-red-500"},"*")],-1)),n(r(y),{id:"dni",modelValue:l.value.dni,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.dni=a),modelModifiers:{trim:!0},required:"",autofocus:"",fluid:"",class:X({"p-invalid":d.value&&!l.value.dni||i.value.dni}),maxlength:"8",onKeydown:Q(j,["enter"])},null,8,["modelValue","class"]),d.value&&!l.value.dni?(o(),t("small",re,"El DNI es obligatorio.")):d.value&&l.value.dni.length!==8?(o(),t("small",de,"El DNI debe tener 8 dígitos.")):i.value.dni?(o(),t("small",ne,v(i.value.dni[0]),1)):c("",!0)]),s("div",ue,[e[15]||(e[15]=s("label",{for:"status",class:"block font-bold mb-2"},[m("Estado "),s("span",{class:"text-red-500"},"*")],-1)),s("div",me,[n(r(ee),{modelValue:l.value.status,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.status=a),binary:!0,inputId:"status"},null,8,["modelValue"]),n(r(le),{value:l.value.status?"Con Acceso":"Sin Acceso",severity:l.value.status?"success":"danger"},null,8,["value","severity"])]),d.value&&!l.value.status?(o(),t("small",ce,"El estado es obligatorio.")):i.value.status?(o(),t("small",ve,v(i.value.status[0]),1)):c("",!0)])]),s("div",null,[e[16]||(e[16]=s("label",{for:"name",class:"block font-bold mb-3"},[m("Nombres "),s("span",{class:"text-red-500"},"*")],-1)),n(r(y),{id:"name",modelValue:l.value.name,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.name=a),modelModifiers:{trim:!0},required:"",maxlength:"100",disabled:"",fluid:""},null,8,["modelValue"]),d.value&&!l.value.name?(o(),t("small",pe,"El nombre es obligatorio.")):d.value&&l.value.name&&l.value.name.length<2?(o(),t("small",fe,"El nombre debe tener al menos 2 caracteres.")):i.value.name?(o(),t("small",be,v(i.value.name[0]),1)):c("",!0)]),s("div",null,[e[17]||(e[17]=s("label",{for:"apellidos",class:"block font-bold mb-3"},[m("Apellidos "),s("span",{class:"text-red-500"},"*")],-1)),n(r(y),{id:"apellidos",modelValue:l.value.apellidos,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.apellidos=a),modelModifiers:{trim:!0},required:"",maxlength:"100",disabled:"",fluid:""},null,8,["modelValue"]),d.value&&!l.value.apellidos?(o(),t("small",ge,"Los apellidos son obligatorios.")):d.value&&l.value.apellidos&&l.value.apellidos.length<2?(o(),t("small",ke,"Los apellidos deben tener al menos 2 caracteres.")):i.value.apellidos?(o(),t("small",xe,v(i.value.apellidos[0]),1)):c("",!0)]),s("div",ye,[s("div",_e,[e[18]||(e[18]=s("label",{for:"nacimiento",class:"block font-bold mb-3"},[m(" Fecha de nacimiento "),s("span",{class:"text-red-500"},"*")],-1)),n(r(y),{modelValue:l.value.nacimiento,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.nacimiento=a),disabled:!b.value,fluid:"",placeholder:"dd/mm/yyyy"},null,8,["modelValue","disabled"]),s("div",Ve,[b.value?(o(),h(r(f),{key:1,label:"Bloquear",icon:"pi pi-lock",size:"small",severity:"danger",onClick:e[6]||(e[6]=a=>b.value=!1)})):(o(),h(r(f),{key:0,label:"Desbloquear",icon:"pi pi-lock-open",size:"small",onClick:e[5]||(e[5]=a=>b.value=!0)}))]),d.value&&!l.value.nacimiento?(o(),t("small",we,"La fecha de nacimiento es obligatoria.")):i.value.nacimiento?(o(),t("small",Ne,v(i.value.nacimiento[0]),1)):c("",!0)]),s("div",he,[e[19]||(e[19]=s("label",{for:"username",class:"block font-bold mb-3"},[m(" Usuario "),s("span",{class:"text-red-500"},"*")],-1)),n(r(y),{modelValue:l.value.username,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.username=a),disabled:!g.value,fluid:""},null,8,["modelValue","disabled"]),s("div",$e,[g.value?(o(),h(r(f),{key:1,label:"Bloquear",icon:"pi pi-lock",size:"small",severity:"danger",onClick:e[9]||(e[9]=a=>g.value=!1)})):(o(),h(r(f),{key:0,label:"Desbloquear",icon:"pi pi-lock-open",size:"small",onClick:e[8]||(e[8]=a=>g.value=!0)}))])])]),s("div",null,[e[20]||(e[20]=s("label",{for:"email",class:"block font-bold mb-3"},[m("Email "),s("span",{class:"text-red-500"},"*")],-1)),n(r(y),{id:"email",modelValue:l.value.email,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.email=a),modelModifiers:{trim:!0},required:"",maxlength:"150",fluid:""},null,8,["modelValue"]),d.value&&!l.value.email?(o(),t("small",Ce,"El correo electrónico es obligatorio.")):d.value&&l.value.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.value.email)?(o(),t("small",Ue,"El correo electrónico debe ser válido.")):i.value.email?(o(),t("small",Ee,v(i.value.email[0]),1)):c("",!0)]),s("div",De,[s("div",qe,[e[21]||(e[21]=s("label",{for:"password",class:"block font-bold mb-3"},[m("Contraseña "),s("small",{class:"text-red-500"},"*")],-1)),n(r(se),{modelValue:l.value.password,"onUpdate:modelValue":e[11]||(e[11]=a=>l.value.password=a),toggleMask:"",placeholder:"contraseña",fluid:"",feedback:!1,inputId:"password"},null,8,["modelValue"]),d.value&&!l.value.password?(o(),t("small",Ie,"La Contraseña es obligatoria.")):d.value&&l.value.password&&l.value.password.length<8?(o(),t("small",Le,"La Contraseña debe tener al menos 8 caracteres.")):i.value.password?(o(),t("small",ze,v(i.value.password[0]),1)):c("",!0)]),s("div",Ae,[e[22]||(e[22]=s("label",{for:"role",class:"block font-bold mb-3"},[m("Rol "),s("span",{class:"text-red-500"},"*")],-1)),n(r(ae),{modelValue:l.value.role_id,"onUpdate:modelValue":e[12]||(e[12]=a=>l.value.role_id=a),options:D.value,optionLabel:"name",optionValue:"id",placeholder:"Seleccione un rol",fluid:"",filter:"",filterPlaceholder:"Buscar rol"},null,8,["modelValue","options"]),d.value&&!l.value.role_id?(o(),t("small",Be,"El rol es obligatorio.")):i.value.role_id?(o(),t("small",Me,v(i.value.role_id[0]),1)):c("",!0)])])])]),_:1},8,["visible"])],64))}});export{Oe as _};
