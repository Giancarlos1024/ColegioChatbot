import{d as A,aa as F,r as u,p as M,B as j,a2 as _,o as G,af as L,e as O,a as d,w as g,g as l,b as c,i as R,f as i,c as p,F as D,X as V,t as $,_ as I,a0 as N}from"./app-CSI2DTQR.js";import{s as W}from"./index-Bd5u6C13.js";import{s as X}from"./index-DWx6GgBR.js";import{s as x}from"./index-CIJ9kEDP.js";import{s as H}from"./index-BsSS1dRr.js";import{s as J}from"./index-CZrl9iAD.js";const K={class:"flex flex-col gap-6"},Q={key:0,class:"text-center p-4"},Y={key:1,class:"permisos-container"},Z={class:"flex justify-between items-center w-full"},ee={class:"font-bold"},se={class:"fieldset-actions flex gap-2"},ae={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},le=["for"],ce=A({__name:"UpdateRoles",props:{visible:{type:Boolean},RolId:{}},emits:["update:visible","updated"],setup(z,{emit:B}){const r=z,f=B,y=F(),w=u([]),t=u([]),m=u(""),v=u(!0),h=u(!1),P=u(!1),k=M(()=>{const s={};return w.value.forEach(e=>{const a=e.name.split(" ")[1]||"Otros";s[a]||(s[a]=[]),s[a].push(e)}),s});j(()=>r.visible,async s=>{s&&r.RolId&&(await E(),await C(r.RolId))});const C=async s=>{var e;v.value=!0;try{const a=await _.get(`/rol/${s}`);m.value=a.data.name,t.value=((e=a.data.permissions)==null?void 0:e.map(o=>o.id))||[]}catch(a){console.error("Error al cargar el rol:",a),y.add({severity:"error",summary:"Error",detail:"No se pudo cargar el rol",life:3e3})}finally{v.value=!1}},E=async()=>{v.value=!0;try{const s=await _.get("/rol/Permisos");w.value=s.data.permissions||[]}catch(s){console.error("Error al obtener permisos:",s),y.add({severity:"error",summary:"Error",detail:"Error al obtener permisos",life:3e3}),w.value=[]}finally{v.value=!1}},S=async()=>{if(P.value=!0,!!m.value){h.value=!0;try{await _.put(`/rol/${r.RolId}`,{name:m.value,permissions:t.value}),y.add({severity:"success",summary:"Actualizado",detail:"Rol y permisos actualizado correctamente",life:3e3}),f("updated"),f("update:visible",!1)}catch(s){console.error("Error al actualizar el rol:",s),y.add({severity:"error",summary:"Error",detail:"Error al actualizar el rol",life:3e3})}finally{h.value=!1}}};function T(s){const e=[...t.value];k.value[s].map(o=>o.id).forEach(o=>{e.includes(o)||e.push(o)}),t.value=e}function U(s){const e=k.value[s].map(a=>a.id);t.value=t.value.filter(a=>!e.includes(a))}return G(async()=>{r.visible&&r.RolId&&(await E(),await C(r.RolId))}),(s,e)=>{const a=L("tooltip");return d(),O(i(W),{visible:s.visible,"onUpdate:visible":e[3]||(e[3]=o=>f("update:visible",o)),style:{width:"95vw",maxWidth:"1000px"},header:"Editar Roles y Permisos",modal:""},{footer:g(()=>[c(i(x),{label:"Cancelar",icon:"pi pi-times",text:"",onClick:e[2]||(e[2]=o=>f("update:visible",!1))}),c(i(x),{label:"Guardar",icon:"pi pi-check",onClick:S,loading:h.value},null,8,["loading"])]),default:g(()=>[l("div",K,[l("div",null,[e[4]||(e[4]=l("label",{for:"name",class:"block font-bold mb-3"},[R("Nombre "),l("span",{class:"text-red-500"},"*")],-1)),c(i(X),{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),fluid:"",required:"",maxlength:"100"},null,8,["modelValue"])]),l("div",null,[e[6]||(e[6]=l("label",{class:"block font-bold mb-3"},[R("Permisos "),l("span",{class:"text-red-500"},"*")],-1)),v.value?(d(),p("div",Q,[...e[5]||(e[5]=[l("i",{class:"pi pi-spin pi-spinner text-2xl"},null,-1),l("p",null,"Cargando permisos...",-1)])])):(d(),p("div",Y,[(d(!0),p(D,null,V(k.value,(o,b)=>(d(),p("div",{key:b,class:"mb-4"},[c(i(J),{toggleable:!0,class:"shadow-sm"},{legend:g(()=>[l("div",Z,[l("span",ee,$(b),1),l("div",se,[I(c(i(x),{icon:"pi pi-check-square",size:"small",text:"",onClick:N(n=>T(b),["stop"])},null,8,["onClick"]),[[a,{value:"Seleccionar todos",showDelay:1e3,hideDelay:300}]]),I(c(i(x),{icon:"pi pi-times",severity:"danger",size:"small",text:"",onClick:N(n=>U(b),["stop"])},null,8,["onClick"]),[[a,{value:"Deseleccionar todos",showDelay:1e3,hideDelay:300}]])])])]),default:g(()=>[l("div",ae,[(d(!0),p(D,null,V(o,n=>(d(),p("div",{key:n.id,class:"flex items-center gap-2 p-2 rounded-md"},[c(i(H),{modelValue:t.value,"onUpdate:modelValue":e[1]||(e[1]=q=>t.value=q),inputId:"permiso_"+n.id,value:n.id},null,8,["modelValue","inputId","value"]),l("label",{for:"permiso_"+n.id,class:"cursor-pointer"},$(n.name),9,le)]))),128))])]),_:2},1024)]))),128))]))])])]),_:1},8,["visible"])}}});export{ce as _};
